{% extends "base.html" %}

{% block main %}
    {{ uj }}
    <div ng-controller="IndexController">
        <md-list>
            <md-list-item layout="row" ng-repeat="user in users">
                {% include "includes/user_list_item.html" %}
            </md-list-item>
        </md-list>
    </div>
{% endblock %}

{% block controller %} //<script>
    var users = {{ users|safe }};
    var projects = {{ projects|safe }};


    app.controller('IndexController', function($scope, $mdDialog, $http) {
        $scope.users = users;
        $scope.projects = projects;

        $scope.onClickCancel = function() {
            $mdDialog.cancel();
        };
        $scope.onSubmitArrived = function() {
            $http({
                method: 'POST',
                url: "{% url 'arrived_api' 999999999 %}".replace('999999999', $scope.user.pk),
                params: {
                },
                success: function() {
                    $mdDialog.hide();
                }
            });
        };
        $scope.onSubmitLeft = function() {
            console.log($scope);
            $http({
                method: 'POST',
                url: "{% url 'left_api' 999999999 %}".replace('999999999', $scope.user.pk),
                data: {
                    "joined_projects": $scope.joinedProjects,
                },
                success: function() {
                    $mdDialog.hide();
                }
            });
            $mdDialog.hide();
        };

        $scope.onClickArrived = function(user) {
            $scope.user = user;
            $mdDialog.show({
                templateUrl: "{% url 'arrived_dialog' %}",
                scope: $scope,
                clickOutsideToClose:true,
                preserveScope: true,
            });
        };
        $scope.onClickLeft = function(user) {
            $scope.user = user;
            $scope.joinedProjects = [];
            $mdDialog.show({
                templateUrl: "{% url 'left_dialog' %}",
                scope: $scope,
                clickOutsideToClose:true,
                preserveScope: true,
            });
        };
        $scope.toggle = function (item, list) {
            var idx = list.indexOf(item);
            if (idx > -1) list.splice(idx, 1);
            else list.push(item);
        };
    });
{% endblock %}